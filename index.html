<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An immersive Valentine's Day experience with interactive features and AI-powered responses">
    <meta name="theme-color" content="#ff4d6d">
    <meta property="og:title" content="Will You Be My Valentine? ‚ù§Ô∏è">
    <meta property="og:description" content="An interactive Valentine's Day invitation">
    <meta property="og:image" content="https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80">
    <meta property="og:type" content="website">
    <title>Will You Be My Valentine? ‚ù§Ô∏è</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* All your CSS styles remain exactly the same - they're perfect */
        :root {
            --primary-pink: #ff4d6d;
            --secondary-pink: #ff758f;
            --light-pink: #ffb3c1;
            --dark-pink: #e84362;
            --background-pink: #fff0f3;
            --shadow-color: rgba(255, 77, 109, 0.2);
            --success-green: #4CAF50;
            --text-dark: #2d3436;
            --text-light: #636e72;
            --accent-gold: #ffd700;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: linear-gradient(135deg, 
                #ffeef2 0%, 
                #fff0f3 25%, 
                #ffecf1 50%, 
                #fff9fb 75%, 
                #ffffff 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            overflow-x: hidden;
            position: relative;
            padding: 20px;
            color: var(--text-dark);
        }
        /* 3D Background Effect */
        .bg-3d {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        .bg-layer {
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 77, 109, 0.1) 0%, 
                transparent 50%),
                radial-gradient(circle at 70% 70%, 
                rgba(255, 180, 193, 0.08) 0%, 
                transparent 50%);
            animation: bgFloat 20s ease-in-out infinite alternate;
        }
        .bg-layer:nth-child(2) {
            animation-delay: -5s;
            animation-duration: 25s;
            background: radial-gradient(circle at 60% 40%, 
                rgba(255, 215, 0, 0.05) 0%, 
                transparent 50%);
        }
        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-2%, 2%) rotate(1deg); }
            50% { transform: translate(-4%, -1%) rotate(-1deg); }
            75% { transform: translate(3%, 3%) rotate(0.5deg); }
        }
        /* Particle System */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        /* Audio Permission Modal */
        #audioPermission {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            animation: fadeIn 0.5s ease;
        }
        .permission-modal {
            background: linear-gradient(135deg, 
                rgba(255, 255,255, 0.95) 0%,
                rgba(255, 255, 255, 0.98) 100%);
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25),
                        0 0 0 1px rgba(255, 255, 255, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.5);
            animation: modalEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
        }
        @keyframes modalEntrance {
            0% { opacity: 0; transform: translateY(40px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        /* Music Controls - Modern Design */
        .music-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
            z-index: 1000;
        }
        .music-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-pink);
            transition: var(--transition);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .music-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            transition: left 0.7s;
        }
        .music-btn:hover::before {
            left: 100%;
        }
        .music-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(255, 77, 109, 0.2);
            border-color: rgba(255, 77, 109, 0.3);
        }
        .music-btn.active {
            background: linear-gradient(135deg, 
                var(--primary-pink), 
                var(--secondary-pink));
            color: white;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 77, 109, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 77, 109, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 77, 109, 0); }
        }
        .pulse-animation {
            animation: pulse-animation 2s infinite !important;
        }
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0 rgba(255, 77, 109, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 77, 109, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 77, 109, 0); }
        }
        .volume-slider-container {
            position: absolute;
            top: 70px;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .volume-slider-container.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        .volume-slider-container input[type="range"] {
            width: 180px;
            height: 6px;
            -webkit-appearance: none;
            background: linear-gradient(90deg, var(--primary-pink), var(--secondary-pink));
            border-radius: 3px;
            outline: none;
        }
        .volume-slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--primary-pink);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        /* Enhanced Countdown */
        #timer {
            margin-bottom: 30px;
            width: 100%;
            max-width: 600px;
        }
        .countdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .countdown-item {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        .countdown-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                var(--primary-pink), 
                var(--secondary-pink));
        }
        .countdown-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(255, 77, 109, 0.15);
        }
        .countdown-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, 
                var(--primary-pink), 
                var(--secondary-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 8px;
            font-family: 'Playfair Display', serif;
        }
        .countdown-label {
            font-size: 0.9rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        /* Main Card - Glass Morphism */
        #card {
            background: var(--glass-bg);
            padding: 50px;
            border-radius: 32px;
            width: 90%;
            max-width: 500px;
            z-index: 10;
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: cardEntrance 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }
        #card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg, 
                transparent 20%, 
                rgba(255, 77, 109, 0.05) 40%, 
                rgba(255, 215, 0, 0.05) 60%, 
                transparent 80%
            );
            transform: rotate(45deg);
            animation: shine 8s infinite linear;
        }
        @keyframes cardEntrance {
            0% { 
                opacity: 0; 
                transform: translateY(60px) rotateX(-15deg) scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) rotateX(0) scale(1); 
            }
        }
        /* Typography */
        h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            line-height: 1.2;
            font-family: 'Dancing Script', cursive;
            background: linear-gradient(45deg, 
                var(--primary-pink), 
                var(--secondary-pink),
                var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--primary-pink), 
                transparent);
        }
        .subtitle {
            color: var(--text-light);
            font-size: 1.2rem;
            margin-bottom: 30px;
            font-weight: 400;
            line-height: 1.6;
            opacity: 0.9;
        }
        /* Image Container with Parallax */
        .image-container {
            position: relative;
            width: 100%;
            margin-bottom: 30px;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
            cursor: pointer;
        }
        .image-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                45deg,
                rgba(255, 77, 109, 0.1),
                rgba(255, 215, 0, 0.1)
            );
            z-index: 1;
            pointer-events: none;
        }
        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .image-container:hover img {
            transform: scale(1.05);
        }
        /* Enhanced Buttons */
        .btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            position: relative;
        }
        .v-btn {
            padding: 20px 50px;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            min-width: 160px;
            position: relative;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            background: transparent;
            color: white;
            z-index: 2;
        }
        .v-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                var(--primary-pink) 0%, 
                var(--secondary-pink) 100%);
            z-index: -1;
            transition: var(--transition);
        }
        .v-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: left 0.7s;
        }
        .v-btn:hover::after {
            left: 100%;
        }
        .v-btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 20px 40px rgba(255, 77, 109, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.5);
        }
        .v-btn:active {
            transform: translateY(1px);
            box-shadow: 
                0 10px 20px rgba(255, 77, 109, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.3);
        }
        #yesBtn {
            background: linear-gradient(135deg, 
                var(--primary-pink) 0%, 
                var(--dark-pink) 100%);
            box-shadow: 
                0 10px 30px rgba(255, 77, 109, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        #noBtn {
            position: absolute;
            z-index: 9999;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: linear-gradient(135deg, 
                #666 0%, 
                #888 100%);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        /* Hidden/Visible States */
        .hidden { 
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: scale(0.8) translateY(20px);
            position: absolute !important;
            transition: var(--transition);
        }
        .visible { 
            opacity: 1;
            visibility: visible;
            pointer-events: all;
            transform: scale(1) translateY(0);
            position: relative !important;
        }
        /* Success Content - Celebration */
        #success-content {
            animation: celebrateEntrance 1s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes celebrateEntrance {
            0% { 
                opacity: 0; 
                transform: translateY(40px) scale(0.9); 
            }
            60% { 
                opacity: 1; 
                transform: translateY(-10px) scale(1.02); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        .success-title {
            color: var(--success-green);
            font-size: 3.5rem;
            margin: 25px 0;
            font-family: 'Dancing Script', cursive;
            animation: pulse 2s infinite;
            background: linear-gradient(45deg, 
                var(--success-green), 
                #81c784,
                #4CAF50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .details {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            text-align: left;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }
        .details::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, 
                var(--primary-pink), 
                var(--secondary-pink));
        }
        .details h3 {
            color: var(--primary-pink);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.4rem;
        }
        .details p {
            color: var(--text-light);
            line-height: 1.8;
            font-size: 1.05rem;
        }
        /* Celebration Effects */
        .celebration-particle {
            position: fixed;
            pointer-events: none;
            z-index: 9997;
            font-size: 24px;
            animation: floatUp 2s ease-out forwards;
        }
        @keyframes floatUp {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        /* Chatbot Interface */
        #chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            max-width: calc(100% - 40px);
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
        }
        .chat-header {
            background: linear-gradient(135deg, 
                var(--primary-pink), 
                var(--secondary-pink));
            color: white;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 20px;
        }
        .message {
            margin-bottom: 15px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 80%;
            animation: messageIn 0.3s ease;
        }
        @keyframes messageIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.user {
            background: linear-gradient(135deg, 
                var(--primary-pink), 
                var(--secondary-pink));
            color: white;
            margin-left: auto;
        }
        .message.bot {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-dark);
            border: 1px solid var(--glass-border);
        }
        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                #ffeef2 0%, 
                #fff0f3 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        .loading-content {
            text-align: center;
            animation: loadingEntrance 0.6s ease;
        }
        @keyframes loadingEntrance {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            width: 80px;
            height: 80px;
            position: relative;
            margin: 0 auto 30px;
        }
        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            animation: spinner 1.5s linear infinite;
        }
        .loading-spinner::before {
            width: 100%;
            height: 100%;
            border: 4px solid transparent;
            border-top: 4px solid var(--primary-pink);
            border-right: 4px solid var(--primary-pink);
        }
        .loading-spinner::after {
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
            border: 4px solid transparent;
            border-top: 4px solid var(--secondary-pink);
            border-right: 4px solid var(--secondary-pink);
            animation-delay: 0.2s;
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            padding: 15px 25px;
            border-radius: 12px;
            color: var(--text-dark);
            font-weight: 500;
            z-index: 10000;
            animation: notificationIn 0.3s ease, notificationOut 0.3s ease 2.7s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        @keyframes notificationIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        @keyframes notificationOut {
            from { opacity: 1; transform: translateX(-50%) translateY(0); }
            to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        /* Responsive Design */
        @media (max-width: 768px) {
            #card {
                padding: 30px 20px;
                width: 95%;
                border-radius: 24px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .btn-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .v-btn {
                width: 100%;
                max-width: 280px;
                padding: 18px 30px;
            }
            
            .countdown-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .countdown-value {
                font-size: 2rem;
            }
            
            .music-controls {
                top: 10px;
                right: 10px;
            }
            
            .music-btn {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }
            
            #chatbot {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .countdown-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .success-title {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 style="color: var(--primary-pink); margin-bottom: 15px;">Preparing Your Special Moment...</h2>
            <p class="subtitle">Loading all the love and surprises ‚ù§Ô∏è</p>
        </div>
    </div>
    <!-- Audio Permission Modal -->
    <div id="audioPermission">
        <div class="permission-modal">
            <div style="font-size: 4rem; color: var(--primary-pink); margin-bottom: 20px;">üéµ</div>
            <h2 style="color: var(--primary-pink); margin-bottom: 15px; font-family: 'Dancing Script', cursive;">Set the Mood</h2>
            <p style="color: var(--text-light); margin-bottom: 25px; line-height: 1.6;">
                To make this Valentine's experience truly special, we'd like to play some romantic background music. 
                This will enhance the atmosphere and make your moment even more memorable.
            </p>
            <button id="enableAudioBtn" class="v-btn" style="margin-bottom: 15px;">
                <i class="fas fa-music"></i> Enable Music & Continue
            </button>
            <p style="color: #999; font-size: 0.9rem; margin-top: 15px;">
                You can control the music anytime using the music button
            </p>
        </div>
    </div>
    <!-- 3D Background -->
    <div class="bg-3d">
        <div class="bg-layer"></div>
        <div class="bg-layer"></div>
    </div>
    <!-- Music Controls -->
    <div class="music-controls">
        <button id="musicControl" class="music-btn" aria-label="Toggle music">
            <i class="fas fa-music"></i>
        </button>
        <button id="nextTrack" class="music-btn" aria-label="Next track">
            <i class="fas fa-forward"></i>
        </button>
        <button id="chatToggle" class="music-btn" aria-label="Open chat">
            <i class="fas fa-comment-dots"></i>
        </button>
        <button id="settingsToggle" class="music-btn" aria-label="Settings">
            <i class="fas fa-cog"></i>
        </button>
        <div id="volumeControl" class="volume-slider-container">
            <div style="margin-bottom: 10px; color: var(--text-dark); font-weight: 500;">
                <i class="fas fa-volume-up"></i> Volume
            </div>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="0.7">
        </div>
    </div>
    <!-- Countdown Timer -->
    <div id="timer" aria-live="polite">
        <div style="text-align: center; margin-bottom: 15px; color: var(--text-light); font-weight: 500;">
            <i class="fas fa-clock"></i> Countdown to Valentine's Day
        </div>
        <div class="countdown-grid">
            <div class="countdown-item">
                <div class="countdown-value" id="days">00</div>
                <div class="countdown-label">Days</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-value" id="hours">00</div>
                <div class="countdown-label">Hours</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-value" id="minutes">00</div>
                <div class="countdown-label">Minutes</div>
            </div>
            <div class="countdown-item">
                <div class="countdown-value" id="seconds">00</div>
                <div class="countdown-label">Seconds</div>
            </div>
        </div>
    </div>
    <!-- Main Card -->
    <div id="card" role="main">
        <!-- Question Content -->
        <div id="question-content" class="visible">
            <div class="image-container" id="mainImage">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOHIycXFqM3B0bmZ4bm91YnB0bmZ4bm91YnB0bmZ4bm91YnB0JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1z/cLS1cfxvGOPVpf9g3y/giphy.gif" 
                     alt="Cute animated cat with heart eyes" 
                     loading="eager"
                     onerror="this.src='https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
            </div>
            
            <div style="text-align: center; margin-bottom: 10px;">
                <span style="background: rgba(255, 77, 109, 0.1); color: var(--primary-pink); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: 500;">
                    <i class="fas fa-heart"></i> Special Invitation
                </span>
            </div>
            
            <h1 id="mainTitle">
                <span class="typing-text">Will you be my Valentine?</span>
            </h1>
            
            <p class="subtitle" id="mainSubtitle">
                Every moment with you feels like a beautiful story. I want to make this Valentine's Day the most memorable chapter yet. What do you say?
            </p>
            
            <div style="margin-bottom: 30px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                <span class="tag">‚ù§Ô∏è Romantic</span>
                <span class="tag">üéâ Fun</span>
                <span class="tag">üåü Memorable</span>
                <span class="tag">üéÅ Surprises</span>
            </div>
            
            <div class="btn-container">
                <button id="yesBtn" class="v-btn">
                    <i class="fas fa-heart"></i> Yes, Absolutely!
                </button>
                <button id="maybeBtn" class="v-btn" style="background: linear-gradient(135deg, #ffb347, #ffcc33);">
                    <i class="fas fa-question-circle"></i> Let me think...
                </button>
            </div>
            
            <div style="margin-top: 25px; color: var(--text-light); font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> Hover over the "No" button if you're unsure üòâ
            </div>
        </div>
        <!-- Success Content -->
        <div id="success-content" class="hidden" aria-live="polite">
            <div class="image-container">
                <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExMG04bmZueXFqM3B0bmZ4bm91YnB0bmZ4bm91YnB0bmZ4bm91JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/KZTvXN9MQU0kGOnR7P/giphy.gif" 
                     alt="Happy dancing cat celebration"
                     loading="lazy"
                     onerror="this.src='https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
            </div>
            
            <h1 class="success-title">You Said Yes! ‚ù§Ô∏è</h1>
            
            <p class="subtitle">
                This just made my entire year! Get ready for the most amazing Valentine's Day ever!
            </p>
            
            <div class="details">
                <h3><i class="fas fa-calendar-alt"></i> Date & Time</h3>
                <p><strong>February 14th, 2026 ‚Ä¢ 7:00 PM</strong></p>
                <p>A romantic evening you'll never forget, filled with laughter, great food, and wonderful memories.</p>
            </div>
            
            <div class="details" style="margin-top: 20px;">
                <h3><i class="fas fa-gift"></i> What to Expect</h3>
                <ul style="color: var(--text-light); line-height: 1.8; margin-left: 20px;">
                    <li>Exclusive romantic dinner under the stars</li>
                    <li>Your favorite music playlist curated just for you</li>
                    <li>Sweet surprises throughout the evening</li>
                    <li>Memory-making experiences you'll cherish forever</li>
                    <li>A special gift that captures this moment</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button id="shareBtn" class="v-btn" style="flex: 1; background: linear-gradient(135deg, #4267B2, #3b5998);">
                    <i class="fas fa-share"></i> Share
                </button>
                <button id="saveDateBtn" class="v-btn" style="flex: 1; background: linear-gradient(135deg, #28a745, #20c997);">
                    <i class="fas fa-calendar-plus"></i> Save Date
                </button>
            </div>
            
            <button id="resetBtn" class="v-btn" style="margin-top: 20px; width: 100%; background: linear-gradient(135deg, #6c757d, #495057);">
                <i class="fas fa-redo"></i> Ask Again
            </button>
        </div>
    </div>
    <!-- No Button (Escaping) -->
    <button id="noBtn" class="v-btn hidden" aria-label="No, I won't be your Valentine">
        <i class="fas fa-times"></i> No
    </button>
    <!-- Chatbot Interface -->
    <div id="chatbot" class="hidden">
        <div class="chat-header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-heart"></i>
                <span>Valentine Assistant</span>
            </div>
            <button id="closeChat" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                Hi there! I'm here to answer any questions about your Valentine's Day plans! ‚ù§Ô∏è
            </div>
        </div>
        <div style="padding: 15px; border-top: 1px solid var(--glass-border);">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="chatInput" placeholder="Ask me anything..." 
                       style="flex: 1; padding: 12px 15px; border-radius: 25px; border: 1px solid var(--glass-border); 
                              background: rgba(255, 255, 255, 0.1); color: var(--text-dark); outline: none;">
                <button id="sendChat" style="background: var(--primary-pink); color: white; border: none; 
                        border-radius: 50%; width: 45px; height: 45px; cursor: pointer;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Settings Panel -->
    <div id="settingsPanel" class="hidden" style="position: fixed; top: 80px; right: 20px; 
          background: var(--glass-bg); backdrop-filter: blur(30px); border-radius: 20px; 
          padding: 25px; border: 1px solid var(--glass-border); box-shadow: 0 20px 60px rgba(0,0,0,0.15);
          width: 300px; z-index: 1000;">
        <h3 style="color: var(--primary-pink); margin-bottom: 20px; font-family: 'Dancing Script', cursive;">
            <i class="fas fa-cog"></i> Settings
        </h3>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">
                <i class="fas fa-heart"></i> Theme Intensity
            </label>
            <input type="range" id="themeIntensity" min="0" max="1" step="0.1" value="0.7" 
                   style="width: 100%; margin-bottom: 15px;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; color: var(--text-dark); font-weight: 500;">
                <i class="fas fa-fire"></i> Effects Level
            </label>
            <input type="range" id="effectsLevel" min="0" max="1" step="0.1" value="0.8" 
                   style="width: 100%; margin-bottom: 15px;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; color: var(--text-dark); cursor: pointer;">
                <input type="checkbox" id="autoPlayMusic" checked>
                <span>Auto-play music</span>
            </label>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; color: var(--text-dark); cursor: pointer;">
                <input type="checkbox" id="darkMode">
                <span>Dark Mode</span>
            </label>
        </div>
        
        <button id="saveSettings" class="v-btn" style="width: 100%; margin-top: 10px;">
            <i class="fas fa-save"></i> Save Settings
        </button>
    </div>
    
    <!-- Particle.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        // SIMPLE WORKING AUDIO SOLUTION - Web Audio API generated music
        class ValentineExperience {
            constructor() {
                this.initElements();
                this.initState();
                this.initEventListeners();
                this.initAnimations();
            }
            
            initElements() {
                this.elements = {
                    loadingScreen: document.getElementById('loading-screen'),
                    audioPermission: document.getElementById('audioPermission'),
                    card: document.getElementById('card'),
                    noBtn: document.getElementById('noBtn'),
                    yesBtn: document.getElementById('yesBtn'),
                    maybeBtn: document.getElementById('maybeBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    shareBtn: document.getElementById('shareBtn'),
                    saveDateBtn: document.getElementById('saveDateBtn'),
                    questionContent: document.getElementById('question-content'),
                    successContent: document.getElementById('success-content'),
                    musicControl: document.getElementById('musicControl'),
                    nextTrack: document.getElementById('nextTrack'),
                    volumeSlider: document.getElementById('volumeSlider'),
                    volumeControl: document.getElementById('volumeControl'),
                    chatToggle: document.getElementById('chatToggle'),
                    chatbot: document.getElementById('chatbot'),
                    closeChat: document.getElementById('closeChat'),
                    chatInput: document.getElementById('chatInput'),
                    sendChat: document.getElementById('sendChat'),
                    chatMessages: document.getElementById('chatMessages'),
                    settingsToggle: document.getElementById('settingsToggle'),
                    settingsPanel: document.getElementById('settingsPanel'),
                    themeIntensity: document.getElementById('themeIntensity'),
                    effectsLevel: document.getElementById('effectsLevel'),
                    autoPlayMusic: document.getElementById('autoPlayMusic'),
                    darkMode: document.getElementById('darkMode'),
                    saveSettings: document.getElementById('saveSettings'),
                    enableAudioBtn: document.getElementById('enableAudioBtn'),
                    timer: {
                        days: document.getElementById('days'),
                        hours: document.getElementById('hours'),
                        minutes: document.getElementById('minutes'),
                        seconds: document.getElementById('seconds')
                    }
                };
            }
            
            initState() {
                this.state = {
                    audioEnabled: false,
                    musicPlaying: false,
                    noBtnClickCount: 0,
                    yesClicked: false,
                    volume: 0.7,
                    themeIntensity: 0.7,
                    effectsLevel: 0.8,
                    escapeMessages: [
                        "No", "Are you sure?", "Really?", "Think again!", 
                        "Last chance!", "Okay fine!", "I give up!", "You win!",
                        "Maybe?", "Pretty please?", "With a cherry on top?",
                        "You're breaking my heart!", "One more chance?",
                        "I'll make it worth it!", "Final offer!", 
                        "You're killing me!", "Alright, you win!", 
                        "Please? ü•∫", "I'll do anything!", "Be mine?",
                        "My heart can't take it!", "I'm begging you!"
                    ],
                    chatHistory: [],
                    settings: {
                        autoPlay: true,
                        theme: 'romantic',
                        effects: 'high',
                        darkMode: false
                    },
                    currentTrack: 0
                };
                
                // Web Audio API components
                this.audioContext = null;
                this.oscillator = null;
                this.gainNode = null;
                this.melodyInterval = null;
            }
            
            initParticles() {
                if (typeof particlesJS !== 'undefined') {
                    particlesJS('particles-js', {
                        particles: {
                            number: { value: 80, density: { enable: true, value_area: 800 } },
                            color: { value: ["#ff4d6d", "#ff758f", "#ffb3c1"] },
                            shape: { type: "circle" },
                            opacity: { value: 0.3, random: true },
                            size: { value: 3, random: true },
                            line_linked: {
                                enable: true,
                                distance: 150,
                                color: "#ff4d6d",
                                opacity: 0.2,
                                width: 1
                            },
                            move: {
                                enable: true,
                                speed: 2,
                                direction: "none",
                                random: true,
                                straight: false,
                                out_mode: "out",
                                bounce: false
                            }
                        },
                        interactivity: {
                            detect_on: "canvas",
                            events: {
                                onhover: { enable: true, mode: "repulse" },
                                onclick: { enable: true, mode: "push" },
                                resize: true
                            }
                        },
                        retina_detect: true
                    });
                }
            }
            
            initEventListeners() {
                // Audio permission
                this.elements.enableAudioBtn.addEventListener('click', () => this.enableAudio());
                
                // Music controls
                this.elements.musicControl.addEventListener('click', () => this.toggleMusic());
                this.elements.nextTrack.addEventListener('click', () => this.nextTrack());
                
                this.elements.musicControl.addEventListener('mouseenter', () => {
                    this.elements.volumeControl.classList.add('show');
                });
                
                this.elements.volumeControl.addEventListener('mouseleave', () => {
                    setTimeout(() => {
                        if (!this.elements.volumeControl.matches(':hover') && 
                            !this.elements.musicControl.matches(':hover')) {
                            this.elements.volumeControl.classList.remove('show');
                        }
                    }, 100);
                });
                
                this.elements.volumeSlider.addEventListener('input', (e) => {
                    this.state.volume = parseFloat(e.target.value);
                    if (this.gainNode) {
                        this.gainNode.gain.value = this.state.volume * 0.5;
                    }
                });
                
                // Main buttons
                this.elements.yesBtn.addEventListener('click', () => this.celebrate());
                this.elements.maybeBtn.addEventListener('click', () => this.showMaybeOptions());
                this.elements.resetBtn.addEventListener('click', () => this.resetExperience());
                this.elements.shareBtn.addEventListener('click', () => this.shareExperience());
                this.elements.saveDateBtn.addEventListener('click', () => this.saveToCalendar());
                
                // No button behavior
                this.elements.noBtn.addEventListener('mouseover', () => this.moveNoButton());
                this.elements.noBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.playSound('click');
                    this.moveNoButton();
                });
                
                // Chat interface
                this.elements.chatToggle.addEventListener('click', () => this.toggleChat());
                this.elements.closeChat.addEventListener('click', () => this.toggleChat(false));
                this.elements.sendChat.addEventListener('click', () => this.sendChatMessage());
                this.elements.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChatMessage();
                });
                
                // Settings
                this.elements.settingsToggle.addEventListener('click', () => this.toggleSettings());
                this.elements.saveSettings.addEventListener('click', () => this.saveSettings());
                
                // Initialize typing animation
                this.initTypingAnimation();
            }
            
            initAnimations() {
                setTimeout(() => {
                    this.elements.loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        this.elements.loadingScreen.style.display = 'none';
                        this.startCountdown();
                        this.startBackgroundAnimations();
                        this.initParticles();
                        this.checkAudioPermission();
                    }, 500);
                }, 1500);
            }
            
            checkAudioPermission() {
                const hasPermission = localStorage.getItem('valentineAudioEnabled');
                if (hasPermission === 'true') {
                    this.state.audioEnabled = true;
                    this.elements.audioPermission.classList.add('hidden');
                    this.elements.noBtn.classList.remove('hidden');
                } else {
                    setTimeout(() => {
                        this.elements.audioPermission.classList.add('visible');
                    }, 500);
                }
            }
            
            enableAudio() {
                // Initialize Web Audio API
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.audioContext = new AudioContext();
                    
                    this.state.audioEnabled = true;
                    localStorage.setItem('valentineAudioEnabled', 'true');
                    
                    this.elements.audioPermission.classList.remove('visible');
                    this.elements.audioPermission.classList.add('hidden');
                    
                    this.elements.noBtn.classList.remove('hidden');
                    this.elements.noBtn.classList.add('visible');
                    
                    this.showNotification("Audio enabled! Click the music button to play üéµ", 2000);
                    
                    if (this.state.settings.autoPlay) {
                        setTimeout(() => {
                            this.playMusic().catch(() => {
                                this.showNotification("Click the music button to start playback", 3000);
                                this.elements.musicControl.classList.add('pulse-animation');
                            });
                        }, 500);
                    }
                    
                } catch (error) {
                    console.error("Audio context failed:", error);
                    this.showNotification("Audio not supported in this browser", 3000);
                }
            }
            
            createMelody() {
                // Generate a simple romantic melody using Web Audio API
                if (!this.audioContext) return;
                
                // Create oscillator and gain node
                this.oscillator = this.audioContext.createOscillator();
                this.gainNode = this.audioContext.createGain();
                
                // Connect nodes
                this.oscillator.connect(this.gainNode);
                this.gainNode.connect(this.audioContext.destination);
                
                // Set oscillator type to sine wave (soft sound)
                this.oscillator.type = 'sine';
                
                // Set volume
                this.gainNode.gain.value = this.state.volume * 0.5;
                
                // Start the oscillator
                this.oscillator.start();
                
                // Create a simple melody pattern
                const melody = [
                    261.63,  // C4
                    329.63,  // E4
                    392.00,  // G4
                    493.88,  // B4
                    392.00,  // G4
                    329.63,  // E4
                    261.63,  // C4
                    196.00   // G3
                ];
                
                let noteIndex = 0;
                
                // Change notes every second to create a melody
                this.melodyInterval = setInterval(() => {
                    if (this.oscillator) {
                        this.oscillator.frequency.setValueAtTime(
                            melody[noteIndex], 
                            this.audioContext.currentTime
                        );
                        noteIndex = (noteIndex + 1) % melody.length;
                    }
                }, 1000);
            }
            
            playMusic() {
                if (!this.state.audioEnabled || !this.audioContext) {
                    this.showNotification("Please enable audio first!", 2000);
                    return;
                }
                
                try {
                    // Resume audio context if suspended (required for Chrome autoplay policy)
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }
                    
                    // Create melody if not already playing
                    if (!this.state.musicPlaying) {
                        this.createMelody();
                        this.state.musicPlaying = true;
                        this.elements.musicControl.classList.add('active');
                        this.elements.musicControl.innerHTML = '<i class="fas fa-pause"></i>';
                        this.elements.musicControl.classList.remove('pulse-animation');
                        
                        this.showNotification("Now playing: Romantic Melody üéµ", 2000);
                    }
                    
                } catch (error) {
                    console.error("Music playback error:", error);
                    this.showNotification("Couldn't play music", 2000);
                }
            }
            
            pauseMusic() {
                if (this.oscillator) {
                    this.oscillator.stop();
                    this.oscillator = null;
                }
                
                if (this.melodyInterval) {
                    clearInterval(this.melodyInterval);
                    this.melodyInterval = null;
                }
                
                this.state.musicPlaying = false;
                this.elements.musicControl.classList.remove('active');
                this.elements.musicControl.innerHTML = '<i class="fas fa-music"></i>';
                this.elements.musicControl.classList.remove('pulse-animation');
                this.showNotification("Music paused", 1500);
            }
            
            toggleMusic() {
                if (this.state.musicPlaying) {
                    this.pauseMusic();
                } else {
                    this.playMusic();
                }
            }
            
            nextTrack() {
                // For this simple version, just restart the melody
                if (this.state.musicPlaying) {
                    this.pauseMusic();
                    setTimeout(() => this.playMusic(), 100);
                }
                this.showNotification("Playing next melody", 1500);
            }
            
            // ... (rest of your methods remain exactly the same) ...
            moveNoButton() {
                if (this.state.yesClicked) return;
                this.state.noBtnClickCount++;
                
                const btnRect = this.elements.noBtn.getBoundingClientRect();
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                const margin = 30;
                const maxX = viewportWidth - btnRect.width - margin;
                const maxY = viewportHeight - btnRect.height - margin;
                const minX = margin;
                const minY = margin;
                
                const randomX = Math.max(minX, Math.min(maxX, Math.random() * viewportWidth));
                const randomY = Math.max(minY, Math.min(maxY, Math.random() * viewportHeight));
                
                this.elements.noBtn.style.left = `${randomX}px`;
                this.elements.noBtn.style.top = `${randomY}px`;
                
                const scale = Math.max(0.4, 1 - (this.state.noBtnClickCount * 0.03));
                this.elements.noBtn.style.transform = `scale(${scale})`;
                
                const messageIndex = Math.min(this.state.noBtnClickCount - 1, this.state.escapeMessages.length - 1);
                const message = this.state.escapeMessages[messageIndex];
                this.elements.noBtn.innerHTML = `<i class="fas fa-times"></i> ${message}`;
                
                if (this.state.noBtnClickCount >= 6) {
                    this.elements.noBtn.style.background = 'linear-gradient(135deg, var(--primary-pink), var(--secondary-pink))';
                    this.elements.noBtn.innerHTML = `<i class="fas fa-heart"></i> ${message}`;
                }
                
                this.createCelebrationParticles(randomX + btnRect.width/2, randomY + btnRect.height/2);
                
                if (this.state.noBtnClickCount > 10) {
                    this.playSound('heartbeat');
                }
            }
            
            celebrate() {
                if (this.state.yesClicked) return;
                
                this.state.yesClicked = true;
                this.playSound('success');
                
                this.elements.questionContent.classList.remove('visible');
                this.elements.questionContent.classList.add('hidden');
                
                setTimeout(() => {
                    this.elements.successContent.classList.remove('hidden');
                    this.elements.successContent.classList.add('visible');
                    this.elements.noBtn.classList.add('hidden');
                }, 400);
                
                if (this.state.audioEnabled && !this.state.musicPlaying && this.state.settings.autoPlay) {
                    this.toggleMusic();
                }
                
                this.grandCelebration();
                this.saveResponse();
                this.showNotification("You've made my day! ‚ù§Ô∏è", 3000);
            }
            
            grandCelebration() {
                const colors = ['#ff4d6d', '#ff758f', '#ffb3c1', '#ffd700', '#ffffff'];
                
                confetti({
                    particleCount: 300,
                    spread: 100,
                    origin: { y: 0.6 },
                    colors: colors,
                    scalar: 1.3
                });
                
                [60, 120, 240, 300].forEach((angle, i) => {
                    setTimeout(() => {
                        confetti({
                            particleCount: 200,
                            angle: angle,
                            spread: 70,
                            origin: { x: (i % 2) ? 0 : 1 },
                            colors: colors
                        });
                    }, i * 200);
                });
                
                setTimeout(() => {
                    this.createHeartConfetti();
                }, 1000);
                
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        this.createCelebrationParticle();
                    }, i * 100);
                }
            }
            
            createHeartConfetti() {
                const heartCanvas = this.createHeartCanvas();
                
                confetti({
                    particleCount: 100,
                    spread: 360,
                    shapes: ['image'],
                    shapeOptions: {
                        image: {
                            src: heartCanvas.toDataURL(),
                            width: 20,
                            height: 20
                        }
                    },
                    startVelocity: 40,
                    gravity: 0.8,
                    scalar: 1.2
                });
            }
            
            createHeartCanvas() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const size = 20;
                
                canvas.width = size;
                canvas.height = size;
                
                ctx.fillStyle = '#ff4d6d';
                ctx.beginPath();
                const t = size/5;
                ctx.moveTo(size/2, t);
                ctx.bezierCurveTo(size/2, t/2, t, t/2, t, t*1.6);
                ctx.bezierCurveTo(t, t*2.5, size/2, size-5, size/2, size-5);
                ctx.bezierCurveTo(size/2, size-5, size-t, t*2.5, size-t, t*1.6);
                ctx.bezierCurveTo(size-t, t/2, size/2, t/2, size/2, t);
                ctx.closePath();
                ctx.fill();
                
                return canvas;
            }
            
            createCelebrationParticles(x, y) {
                for (let i = 0; i < 5; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'celebration-particle';
                    particle.innerHTML = '‚ù§Ô∏è';
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y}px`;
                    particle.style.fontSize = `${10 + Math.random() * 20}px`;
                    particle.style.color = ['#ff4d6d', '#ff758f', '#ffb3c1'][Math.floor(Math.random() * 3)];
                    
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 2000);
                }
            }
            
            createCelebrationParticle() {
                const x = Math.random() * window.innerWidth;
                const y = window.innerHeight;
                this.createCelebrationParticles(x, y);
            }
            
            startCountdown() {
                const update = () => {
                    const targetDate = new Date("February 14, 2026 00:00:00").getTime();
                    const now = new Date().getTime();
                    const diff = targetDate - now;
                    
                    if (diff <= 0) {
                        this.elements.timer.days.textContent = '00';
                        this.elements.timer.hours.textContent = '00';
                        this.elements.timer.minutes.textContent = '00';
                        this.elements.timer.seconds.textContent = '00';
                        document.getElementById('timer').innerHTML = `
                            <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, var(--primary-pink), var(--secondary-pink)); 
                                   color: white; border-radius: 20px; font-size: 1.3rem; font-weight: 600;">
                                ‚ù§Ô∏è Happy Valentine's Day! ‚ù§Ô∏è
                            </div>
                        `;
                        return;
                    }
                    
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    const format = (num) => num < 10 ? `0${num}` : num;
                    
                    this.elements.timer.days.textContent = format(days);
                    this.elements.timer.hours.textContent = format(hours);
                    this.elements.timer.minutes.textContent = format(minutes);
                    this.elements.timer.seconds.textContent = format(seconds);
                    
                    requestAnimationFrame(update.bind(this));
                };
                update();
            }
            
            startBackgroundAnimations() {
                const layers = document.querySelectorAll('.bg-layer');
                layers.forEach((layer, i) => {
                    layer.style.animationDelay = `${i * -5}s`;
                });
                
                setInterval(() => {
                    if (!this.state.yesClicked && Math.random() > 0.7) {
                        this.moveNoButton();
                    }
                }, 4000);
            }
            
            showMaybeOptions() {
                this.showNotification("Let's talk about it! Click the chat button üí¨", 3000);
                this.toggleChat();
            }
            
            resetExperience() {
                this.playSound('click');
                
                this.elements.successContent.classList.remove('visible');
                this.elements.successContent.classList.add('hidden');
                
                setTimeout(() => {
                    this.elements.questionContent.classList.remove('hidden');
                    this.elements.questionContent.classList.add('visible');
                    
                    this.state.noBtnClickCount = 0;
                    this.state.yesClicked = false;
                    this.elements.noBtn.classList.remove('hidden');
                    this.elements.noBtn.classList.add('visible');
                    this.elements.noBtn.style.background = 'linear-gradient(135deg, #666, #888)';
                    this.elements.noBtn.innerHTML = '<i class="fas fa-times"></i> No';
                    this.elements.noBtn.style.transform = 'scale(1)';
                    this.elements.noBtn.style.position = 'fixed';
                    this.elements.noBtn.style.left = '50%';
                    this.elements.noBtn.style.top = '60%';
                    this.elements.noBtn.style.transform = 'translateX(-50%)';
                    
                    localStorage.removeItem('valentineResponse');
                    
                    this.showNotification("Starting fresh! Take your time ‚ù§Ô∏è", 2000);
                }, 400);
            }
            
            shareExperience() {
                if (navigator.share) {
                    navigator.share({
                        title: "I said YES! ‚ù§Ô∏è",
                        text: "I just accepted the most amazing Valentine's Day invitation!",
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href);
                    this.showNotification("Link copied to clipboard! üìã", 2000);
                }
            }
            
            saveToCalendar() {
                const event = {
                    title: "Valentine's Date ‚ù§Ô∏è",
                    start: new Date('2026-02-14T19:00:00'),
                    end: new Date('2026-02-14T23:00:00'),
                    location: "Special Location (To be revealed)",
                    description: "The most romantic Valentine's Day ever!"
                };
                
                const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${event.title}
DTSTART:${this.formatDate(event.start)}
DTEND:${this.formatDate(event.end)}
LOCATION:${event.location}
DESCRIPTION:${event.description}
END:VEVENT
END:VCALENDAR`;
                
                const blob = new Blob([icsContent], { type: 'text/calendar' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'valentines-date.ics';
                a.click();
                
                this.showNotification("Calendar event saved! üìÖ", 2000);
            }
            
            formatDate(date) {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            }
            
            toggleChat(show = null) {
                const shouldShow = show !== null ? show : this.elements.chatbot.classList.contains('hidden');
                
                if (shouldShow) {
                    this.elements.chatbot.style.display = 'block';
                    setTimeout(() => {
                        this.elements.chatbot.classList.remove('hidden');
                        this.elements.chatbot.classList.add('visible');
                        this.elements.chatInput.focus();
                    }, 10);
                } else {
                    this.elements.chatbot.classList.remove('visible');
                    this.elements.chatbot.classList.add('hidden');
                    setTimeout(() => {
                        this.elements.chatbot.style.display = 'none';
                    }, 300);
                }
            }
            
            async sendChatMessage() {
                const message = this.elements.chatInput.value.trim();
                if (!message) return;
                
                this.addChatMessage(message, 'user');
                this.elements.chatInput.value = '';
                
                const response = await this.generateBotResponse(message);
                setTimeout(() => {
                    this.addChatMessage(response, 'bot');
                }, 1000);
            }
            
            addChatMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.textContent = text;
                this.elements.chatMessages.appendChild(messageDiv);
                this.elements.chatMessages.scrollTop = this.elements.chatMessages.scrollHeight;
                
                this.state.chatHistory.push({ sender, text });
            }
            
            async generateBotResponse(message) {
                const responses = {
                    greetings: [
                        "Hello there! So excited about Valentine's Day! ‚ù§Ô∏è",
                        "Hi! Ready for the most romantic day ever?",
                        "Hey! Let's make this Valentine's Day unforgettable!"
                    ],
                    questions: {
                        location: "The location is a surprise! But I promise it'll be magical ‚ú®",
                        time: "We're meeting at 7:00 PM on February 14th, 2026 ‚è∞",
                        dress: "Dress to impress! It's going to be a special evening üëó",
                        gifts: "Your presence is the best gift! But there might be surprises... üéÅ",
                        food: "We'll have a mix of your favorites ‚Äì romantic dinner with candlelight! üçΩÔ∏è",
                        activities: "Besides dinner, there might be dancing, stargazing, and more surprises! üíÉ",
                        weather: "Don't worry about the weather; it's all planned to be perfect! ‚òÄÔ∏è"
                    },
                    general: [
                        "That sounds wonderful! I can't wait to spend time with you ‚ù§Ô∏è",
                        "Great question! Let me think about that...",
                        "I'm so excited! This is going to be amazing!",
                        "Let's make this Valentine's Day one to remember forever!",
                        "You're the best! Can't wait for our special day! üòç"
                    ]
                };
                
                const lowerMessage = message.toLowerCase();
                
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                    return responses.greetings[Math.floor(Math.random() * responses.greetings.length)];
                }
                
                if (lowerMessage.includes('where') || lowerMessage.includes('location')) {
                    return responses.questions.location;
                }
                
                if (lowerMessage.includes('when') || lowerMessage.includes('time')) {
                    return responses.questions.time;
                }
                
                if (lowerMessage.includes('wear') || lowerMessage.includes('dress')) {
                    return responses.questions.dress;
                }
                
                if (lowerMessage.includes('gift') || lowerMessage.includes('present')) {
                    return responses.questions.gifts;
                }
                
                if (lowerMessage.includes('food') || lowerMessage.includes('dinner')) {
                    return responses.questions.food;
                }
                
                if (lowerMessage.includes('activities') || lowerMessage.includes('plan')) {
                    return responses.questions.activities;
                }
                
                if (lowerMessage.includes('weather')) {
                    return responses.questions.weather;
                }
                
                if (lowerMessage.includes('yes') || lowerMessage.includes('sure') || lowerMessage.includes('okay')) {
                    return "Yay! I'm so happy! This is going to be amazing! ü•∞";
                }
                
                return responses.general[Math.floor(Math.random() * responses.general.length)];
            }
            
            toggleSettings(show = null) {
                const shouldShow = show !== null ? show : this.elements.settingsPanel.classList.contains('hidden');
                
                if (shouldShow) {
                    this.elements.settingsPanel.classList.remove('hidden');
                    this.elements.settingsPanel.classList.add('visible');
                } else {
                    this.elements.settingsPanel.classList.remove('visible');
                    this.elements.settingsPanel.classList.add('hidden');
                }
            }
            
            saveSettings() {
                this.state.themeIntensity = parseFloat(this.elements.themeIntensity.value);
                this.state.effectsLevel = parseFloat(this.elements.effectsLevel.value);
                this.state.settings.autoPlay = this.elements.autoPlayMusic.checked;
                this.state.settings.darkMode = this.elements.darkMode.checked;
                
                document.documentElement.style.setProperty('--primary-pink', 
                    `rgba(255, 77, 109, ${this.state.themeIntensity})`);
                
                document.body.classList.toggle('dark-mode', this.state.settings.darkMode);
                
                this.showNotification("Settings saved! ‚ú®", 2000);
                this.toggleSettings(false);
            }
            
            initTypingAnimation() {
                const title = document.querySelector('.typing-text');
                const text = "Will you be my Valentine?";
                let i = 0;
                
                const typeWriter = () => {
                    if (i < text.length) {
                        title.textContent = text.substring(0, i + 1);
                        i++;
                        setTimeout(typeWriter, 50 + Math.random() * 50);
                    }
                };
                
                setTimeout(typeWriter, 1000);
            }
            
            playSound(type) {
                if (!this.state.audioEnabled || !this.audioContext) return;
                
                try {
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }
                    
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    if (type === 'click') {
                        oscillator.frequency.value = 800;
                        gainNode.gain.value = 0.1;
                        oscillator.start();
                        setTimeout(() => oscillator.stop(), 100);
                    } else if (type === 'success') {
                        oscillator.frequency.value = 523.25;
                        gainNode.gain.value = 0.2;
                        oscillator.start();
                        setTimeout(() => {
                            oscillator.frequency.value = 659.25;
                        }, 100);
                        setTimeout(() => {
                            oscillator.frequency.value = 783.99;
                        }, 200);
                        setTimeout(() => oscillator.stop(), 300);
                    } else if (type === 'heartbeat') {
                        oscillator.frequency.value = 100;
                        gainNode.gain.value = 0.15;
                        oscillator.start();
                        setTimeout(() => oscillator.stop(), 200);
                    }
                } catch (error) {
                    // Silent fail
                }
            }
            
            showNotification(message, duration = 3000) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <i class="fas fa-heart" style="color: var(--primary-pink);"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, duration);
            }
            
            saveResponse() {
                localStorage.setItem('valentineResponse', JSON.stringify({
                    yes: true,
                    date: new Date().toISOString(),
                    count: this.state.noBtnClickCount
                }));
            }
            
            checkPreviousResponse() {
                try {
                    const saved = JSON.parse(localStorage.getItem('valentineResponse'));
                    if (saved && saved.yes) {
                        this.state.yesClicked = true;
                        this.state.noBtnClickCount = saved.count || 0;
                        
                        this.elements.questionContent.classList.add('hidden');
                        this.elements.successContent.classList.remove('hidden');
                        this.elements.successContent.classList.add('visible');
                        this.elements.noBtn.classList.add('hidden');
                        
                        const date = new Date(saved.date);
                        const subtitle = document.querySelector('#success-content .subtitle');
                        if (subtitle) {
                            subtitle.innerHTML += `
                                <br><small style="color: var(--primary-pink); font-size: 0.9rem; margin-top: 10px; display: block;">
                                    You said yes on ${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                </small>
                            `;
                        }
                    }
                } catch (e) {
                    // Ignore errors
                }
            }
        }
        
        // Initialize the experience
        document.addEventListener('DOMContentLoaded', () => {
            window.valentineExperience = new ValentineExperience();
            window.valentineExperience.checkPreviousResponse();
        });
    </script>
</body>
</html>
